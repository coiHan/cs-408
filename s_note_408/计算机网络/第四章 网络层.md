# ***第四章 网络层***







# 4.1 网络层的几个重要概念





## 4.1.1 网络层提供的两种服务

​	争论两种服务的实质：可靠交付到底由谁来负责？网络还是端系统？

​	**虚电路 Virtual Circuit**（借鉴了电话网的设计）实际是是逻辑链接，并没有建立真实的物理链接。

​	互联网采用的设计思路：

​		*网络层要设计的尽量简单向上层只是提供简单灵活的，无连接的，尽最大努力交付的数据报服务。*
​																			（IP数据报=IP分组）
​	即***网络层不提供服务质量的承诺***



<img src="D:\Study\s_note_408\计算机网络\第四章 网络层.assets\image-20240513210037989.png" alt="image-20240513210037989" style="zoom: 50%;" />





## 4.1.2 网络层的两个层面

​	

- 控制层面：传送路由信息。
- 数据层面：转发源主机和目的主机之间所送的数据。

<img src="D:\Study\s_note_408\计算机网络\第四章 网络层.assets\image-20240513210109845.png" alt="image-20240513210109845" style="zoom: 67%;" />

​		软件定义网络SDN中对这两个层面的变革

<img src="D:\Study\s_note_408\计算机网络\第四章 网络层.assets\image-20240513210137569.png" alt="image-20240513210137569" style="zoom: 67%;" />



SDN的改变与传统互联网的区别：
	传统互联网中的路由器既有转发表又有路由选择软件，而SDN中路由器只需要转发表，完成数据层面的要求即可。
路由器中的路由选择软件不在了，路由器之间不需要再交换路由信息。在网络层的控制层面有一个逻辑上的**远程控制器**
（在物理上可由多个服务器组成）这种相对于原本网络分散控制变成相对集中控制，在某些场景下更优。



# 4.2 网际协议IP

网际协议IP是TCP/IP中两个最重要的协议之一。

与网际协议（IP）配合使用的还有三个协议。

- 地址解析协议（ARP）
- 网际控制报文协议（ICMP）
- 网际组管理协议（IGMP）

<img src="D:\Study\s_note_408\计算机网络\第四章 网络层.assets\image-20240513214155877.png" alt="image-20240513214155877" style="zoom:50%;" />

## 4.2.1 虚拟互联网络

将网络连接起来的中间设备

- 物理层设备：转发器（也叫中继器），集线器（多端口的中继器）
- 链路层设备：网桥（桥接器），交换机
- 网络层设备：路由器
- 网络层以上设备叫网关。用网关连接两个不兼容的系统需要在高层进行协议的转换。

​	许多计算机网络通过一些路由器互连，由于参加互连的计算机网络都使用相同的***网际协议IP***，因此可以把互连后的计算机网络看成一个**虚拟互连网络**（也称**逻辑互连网络**）。使得在网络层看起来好像是一个统一的网络。利用协议IP的这种虚拟互连网络可简称为**IP网**
​	***IP网的好处***：当IP上的主机进行通信时，就好像在一个单个网络上通信一样，它们看不见互连的各网络的具体异构细节（如具体的编址方案，路由选择协议等）。如果在这种覆盖全球的IP网的上层使用TCP协议，那么就是现在的**互联网（Internet）**。

<img src="D:\Study\s_note_408\计算机网络\第四章 网络层.assets\image-20240514154933107.png" alt="image-20240514154933107" style="zoom: 50%;" />





## 4.2.2 IP地址

**1.IP地址及其表示方法**

<img src="D:\Study\s_note_408\计算机网络\第四章 网络层.assets\image-20240514160522654.png" alt="image-20240514160522654" style="zoom:67%;" />

<img src="D:\Study\s_note_408\计算机网络\第四章 网络层.assets\image-20240514160808185.png" alt="image-20240514160808185" style="zoom:67%;" />

<img src="D:\Study\s_note_408\计算机网络\第四章 网络层.assets\image-20240514160827745.png" alt="image-20240514160827745" style="zoom:67%;" />

**2.分类的IP地址**

<img src="D:\Study\s_note_408\计算机网络\第四章 网络层.assets\image-20240514160903033.png" alt="image-20240514160903033" style="zoom:67%;" />

**3.无分类编址CIDR**

<img src="D:\Study\s_note_408\计算机网络\第四章 网络层.assets\image-20240514161047581.png" alt="image-20240514161047581" style="zoom:67%;" />













## 4.2.3 IP地址与MAC地址

## 4.2.4 地址解析协议ARP

## 4.2.5 IP数据报的格式



# 4.3 IP层转发分组的过程



## 4.3.1 基于终点的转发

## 4.3.2 最长前缀匹配

## 4.3.3 使用二叉线索查找转发表



## 4.4 网际控制报文协议ICMP

## 4.4.1 ICMP报文的种类

## 4.4.2 ICMP的应用举例



# 4.5 IPv6

## 4.5.1 IPv6的基本首部

## 4.5.2 IPv6的地址

## 4.5.3 从IPv4向IPv6过渡

## 4.5.4 ICMPv6











